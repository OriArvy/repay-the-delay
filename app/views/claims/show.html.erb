

<%= render 'shared/navbar' %>

<div class="container">
  <h4 class ="pt-4 pl-1">Claim Overview</h4>
  <div class="row">
    <div class="claim-card w-100 ml-3 mr-3 p-3">
      <span><strong>Journey Details</strong></span><br>
      <span><%= "#{@claim.location_from} â†’ #{@claim.location_to}" %></span><br>
      <span><%= "#{@claim.departure_time.slice(0, 2)}:#{@claim.departure_time.slice(2, 2)} on #{@claim.departure_date}" %></span>
      <div class="row justify-content-center">
        <% if @claim.delay_duration.to_i >= 15 %>
        <div class="text-center claim-alert pl-2 pr-2 ml-3 mr-3 mt-2"><%= "#{@claim.delay_duration} min delay on this journey" %> </div>
        <% end  %>
      </div>

      <div class="row">
        <span class="ml-3 mt-3"><strong>Name</strong></span><br>
      </div>
      <div class="row">
        <span class="ml-3"><%= "#{current_user.first_name} #{current_user.last_name}" %></span><br>
      </div>

      <div class="row">
        <span class="ml-3 mt-3"><strong>Address</strong></span><br>

      </div>
      <div class="row">
        <span class="ml-3"><%= "#{current_user.address}" %></span>
      </div>
      <div class="row">
        <span class="ml-3"><%= "#{current_user.city}" %></span>
      </div>
      <div class="row">
        <span class="ml-3"><%= "#{current_user.postcode}" %></span>
      </div>
<% if @claim.delay_duration.to_i >= 15 %>
  <p>Your train was delayed by: <%= @claim.delay_duration %> min. Reason for Delay: <%= @claim.reason_for_delay %>.</p>
  <p> Full Delay reason: <%= @delay_reason.reason %></p>
  <div class="row">
        <span class="ml-3 mt-3"><strong>Evidence</strong></span><br>
  <p><strong>You might be entitled to compensation as the delay exceeded 15 min.</strong></p>

  <% if current_user.tickets.first.nil? %>
     <!-- USER HAS NO TICKETS -->
     <%= link_to "Add a ticket", new_claim_ticket_path(@claim), class: "btn btn-primary m-2" %>
  <% else %>
    <!-- USER HAS ONE OR MORE TICKETS -->
    <h5>Select/Add a Ticket</h5>
    <select class="dropdown" name="tickets" id="claim-ticket-select">
      <% current_user.tickets.order(created_at: :desc).each do |ticket| %>
         <option value="<%= ticket.id %>">Ticket No:<%= ticket.ticket_number %>
              exp: <%= ticket.expiry_date %>
         </option>
      <% end %>
    </select><br>
    <%= link_to "Add a ticket", new_claim_ticket_path(@claim), class: "btn btn-primary m-2" %>
  <% end %>


  <div>
    <% unless current_user.photo_card == nil  %>
      <%= cl_image_tag current_user.photo_card.photo, width: 300, height: 200, crop: :fill %>
    <% else %>
      <%= link_to "Add a photo card", new_claim_photo_card_path(@claim), class: "btn btn-primary m-2" %>
    <% end %>
  </div>
  <div>
    <input type="checkbox" id="terms" name="terms" value="accepted" checked >
    <label for="terms">I accept that by submitting this claim I agree to the <%= link_to "Terms and conditions", root_path %> including checking the submitted details for accuracy and potential fraud. I confirm that I am not a robot.</label>
  </div>


  <%= simple_form_for(@claim) do |f| %>
    <%= f.input :ticket_id, as: :hidden, input_html: { value: current_user.tickets.last&.id } %>
    <%= f.submit "Claim your refund now", disabled: current_user.tickets.empty?, id: "submission" %>
  <% end %>



<% elsif @claim.delay_duration.to_i.positive? %>
  <p>Your train was delayed by: <%= @claim.delay_duration %> min. Reason for Delay: <%= @claim.reason_for_delay %>.</p>
  <p><strong>You are not entitled to compensation as the delay is less than 15 min.</strong></p>
  <%= link_to "Check another train", root_path %>
<% else %>
  <p><strong>Info: Your train was on time.</strong></p>
  <%= link_to "Check another train", root_path %>
<% end %>

 </div>






























<!--
    </div>
    <div class="claim-card w-100 ml-3 mr-3 p-3 mt-3">
          <div class="row">
            <input type="checkbox" id="terms" name="terms" value="accepted" checked >
            <label for="terms" class="tc-text">You agree to the <!%= link_to "Terms and conditions", root_path %> including checking details for accuracy.</label>
          </div>
          <div class="row">
            <div class="ml-3 mr-3 btn btn-warning btn-block">Submit claim</div>
          </div>
    </div>
  </div>

 -->




